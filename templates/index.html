{%extends "base.html"%} {%block content%}
<link
  rel="stylesheet"
  href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=sort"
/>
<link
  rel="stylesheet"
  href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=filter_alt"
/>
<!-- ここの内側にbodyの中身をお願いします！！ -->
 <div id="hero-section">
  <div id="hero-content">
    <small style="color: #ff4ea9">ーDASHBOARD</small>
      <h1>
        こんにちは、
        <span
          style="
            background: linear-gradient(
              90deg,
              #ff4ea9 0%,
              #ff5162 60%,
              #ff4444 80%
            );
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
          "
        >
          {{ username }}さん
        </span>
      </h1>
      <div style="display:flex; justify-content: center; width: 100%; gap:30px;">
        <div style="background-color:#fff; height: 50px; width: 250px; z-index: 1; border-radius: 10px; border: #3931d5 1px solid; padding: 10px;">現在のコレクション数</div>
        <div style="background-color:#fff; height: 50px; width: 250px; z-index: 1; border-radius: 10px; border: #d59931 1px solid; padding: 10px;">カテゴリー数</div>
        <div style="background-color:#fff; height: 50px; width: 250px; z-index: 1; border-radius: 10px; border: #d53196 1px solid; padding: 10px;">最終更新</div>
    </div>
    <small>
      現在のコレクションに
      <span style="font-weight: bold">{{ items | length }}</span>
      点のアイテムが登録されています
    </small>
    <div class="dashed-grid-bg"></div>
  </div>
  <ul class="circles">
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
  </ul>
</div>
<div class="filter-overall">
  <div id="category-filters">
    <img
      src="/static/images/icons/filter.svg"
      alt="カテゴリーアイコン"
      width="24"
      height="24"
    />
    <div id="category-right">
      <small>カテゴリー</small>
      <div id="category-select-wrapper">
        <select name="category">
          <option>全てのアイテム</option>
          {%for category in categories%}
          <option class="category-options">{{category.name}}</option>
          {%endfor%}
        </select>
        <span class="arrow">⌄</span>
      </div>
    </div>
  </div>
  <div class="sort-controls">
    <div id="sort">
      <img
        src="/static/images/icons/sort.svg"
        alt="並び替えアイコン"
        width="24"
        height="24"
      />
      <select name="sort">
        <option value="newest">新しい順</option>
        <option value="num_items_desc">個数が多い順</option>
        <option value="num_items_asc">個数が少ない順</option>
      </select>
    </div>
    <!-- <img class="view_confy" src="/static/images/icons/list_pink.svg" alt="並び替えアイコン" width="24" height="24" />
    <img src="/static/images/icons/view_comfy_black.svg" alt="並び替えアイコン" width="24" height="24" /> -->
  </div>
</div>
<section class="goods-list" id="goodsList">
  {% include "components/item_list.html" %}
</section>
<div id="modalOverlay"></div>

<script>
  const cards = Array.from(document.querySelectorAll(".card"));
  $(document).on("click", ".card", function () {
    const itemId = $(this).data("item-id");
    if (!itemId) {
      console.error("itemIdがありません");
      return;
    }
    $("#modalOverlay").load(`/items/${itemId}/modal`); //ajaxで操作
    $("#modalOverlay").load(`/items/${itemId}/modal`, function () {
      requestAnimationFrame(() => {
        $("#modalOverlay").addClass("is-open");
      });
    });

    $(document).on("pointerup", "#modalOverlay", "#closeModal", function (e) {
      if (e.target.id === "modalOverlay" || e.target.id ==="closeModal") {
        if (window.innerWidth <= 430) {
          $(".modal").css("transform", "translateY(100%)");
          setTimeout(() => {
            $(this).removeClass("is-open").empty();
          }, 350);
        } else { //PCの場合
          $(this).removeClass("is-open").empty();
        }
      }
    });
  });
  $("#sort select").on("change", function () {
    const sortValue = $(this).val();
    const categoryValue = $("#category-select-wrapper select").val();
    $.ajax({
      url: "/",
      type: "GET",
      data: {
        sort: sortValue,
        category: categoryValue,
      },
      success: function (response) {
        $("#goodsList").html(response);
      },
      error: function (xhr, status, error) {
        console.error("読み込みに失敗しました:", error);
      },
    });
  });
  $("#category-select-wrapper select").on("change", function () {
    const categoryValue = $(this).val();
    const sortValue = $("#sort select").val();
    $.ajax({
      url: "/",
      type: "GET",
      data: {
        sort: sortValue,
        category: categoryValue,
      },
      success: function (response) {
        $("#goodsList").html(response);
      },
      error: function (xhr, status, error) {
        console.error("読み込みに失敗しました:", error);
      },
    });
  });
</script>

<style>
  .hidden {
    display: none;
  }
  /* ===== ヘッダーメッセージ ===== */
  #hero-section{
    position: relative;
    padding-top: 90px;
    padding-bottom: 40px;
  }
  #hero-content {
    margin: 0px 20px;
    display: flex;
    flex-direction: column;
    gap:20px;
    text-align: center;
    justify-content: center;
  }
.dashed-grid-bg{
  position: absolute;
  inset: 0;
  z-index: -2;
  background-image:
    linear-gradient(to right, #e7e5e4 1px, transparent 1px),
    linear-gradient(to bottom, #e7e5e4 1px, transparent 1px);
  background-size: 20px 20px;
  background-position: 0 0, 0 0;

  mask-image:
    repeating-linear-gradient(
      to right,
      black 0px,
      black 3px,
      transparent 3px,
      transparent 8px
    ),
    repeating-linear-gradient(
      to bottom,
      black 0px,
      black 3px,
      transparent 3px,
      transparent 8px
    ),
    radial-gradient(
      ellipse 80% 80% at 0% 0%,
      #000 50%,
      transparent 90%
    );
  -webkit-mask-image:
    repeating-linear-gradient(
      to right,
      black 0px,
      black 3px,
      transparent 3px,
      transparent 8px
    ),
    repeating-linear-gradient(
      to bottom,
      black 0px,
      black 3px,
      transparent 3px,
      transparent 8px
    ),
    radial-gradient(
      ellipse 80% 80% at 0% 0%,
      #000 50%,
      transparent 90%
    );

  mask-composite: intersect;
  -webkit-mask-composite: source-in;
}
.circles{
  position: absolute;
  top: 0;
  left: 0;
  z-index: -1;
  width: 100%;
  height: 100%;
  overflow: hidden;
}

.circles li{
  position: absolute;
  display: block;
  list-style: none;
  width: 20px;
  height: 20px;
  background: rgba(255, 255, 255, 0.2);
  animation: animate 25s linear infinite;
  bottom: -150px;
  
}

.circles li:nth-child(1){
  left: 25%;
  width: 80px;
  height: 80px;
  animation-delay: 0s;
  animation-duration: 45s;
  background-color: #ff4ea9E6;
}


.circles li:nth-child(2){
  left: 10%;
  width: 20px;
  height: 20px;
  animation-delay: 2s;
  animation-duration: 35s;
  background-color: #ff5162E6;
}

.circles li:nth-child(3){
  left: 70%;
  width: 20px;
  height: 20px;
  animation-delay: 4s;
  background-color: #ff9b4ee6;
}

.circles li:nth-child(4){
  left: 40%;
  width: 60px;
  height: 60px;
  animation-delay: 0s;
  animation-duration: 10s;
  background-color: #4466ffe6;
}

.circles li:nth-child(5){
  left: 65%;
  width: 20px;
  height: 20px;
  animation-delay: 0s;
  animation-duration: 25s;
  background-color: #ff4444E6;
}

.circles li:nth-child(6){
  left: 75%;
  width: 110px;
  height: 110px;
  animation-delay: 3s;
  background-color: #ffec44e6;
}

.circles li:nth-child(7){
  left: 35%;
  width: 150px;
  height: 150px;
  animation-delay: 13s;
  background-color: #ffa244e6;
}

.circles li:nth-child(8){
  left: 50%;
  width: 25px;
  height: 25px;
  animation-delay: 15s;
  animation-duration: 45s;
  background-color: #ffb744e6;
}

.circles li:nth-child(9){
  left: 20%;
  width: 15px;
  height: 15px;
  animation-delay: 6s;
  animation-duration: 45s;
  background-color: #ff44e9e6;
}

.circles li:nth-child(10){
  left: 85%;
  width: 150px;
  height: 150px;
  animation-delay: 0s;
  animation-duration: 45s;
  background-color: #ff446de6;
}



@keyframes animate {

  0%{
      transform: translateY(0) rotate(0deg);
      opacity: 1;
      border-radius: 0;
  }

  100%{
      transform: translateY(-1000px) rotate(720deg);
      opacity: 0;
      border-radius: 50%;
  }

}
  /* ===== 検索部分全体 =====*/
  .filter-overall {
    display: flex;
    justify-content: space-between;
    background-color: white;
    border-radius: 12px;
    border: #eee 1px solid;
    padding: 10px;
    margin-bottom: 20px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }
  /* ===== カテゴリーセレクト部分 ===== */
  #category-filters {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px;
    width: 260px;
    background-color: #f3f4f6;
    border-radius: 12px;
    border: 1px solid #eee;
  }
  /* カテゴリーの右側部分 */
  #category-right {
    display: flex;
    flex-direction: column;
    gap: 6px;
    flex: 1;
  }
  #category-right small {
    font-size: 8px;
    color: #666;
  }
  /* カテゴリーセレクトのオプション選択部分 */
  #category-select-wrapper {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  #category-select-wrapper select {
    flex: 1;
    border: none;
    background: transparent;
    font-size: 14px;
    cursor: pointer;
    -webkit-appearance: none;
    appearance: none;
  }
  #category-select-wrapper select:focus {
    outline: none;
    box-shadow: none;
    border-color: #ccc;
  }
  #category-select-wrapper .arrow {
    color: #aaa;
    pointer-events: none;
  }
  /* ===== 並び替え部分 ===== */
  .sort-controls {
    display: flex;
    align-items: center;
    gap: 12px;
  }
  #sort {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px;
    width: 160px;
    border-radius: 12px;
    border: 1px solid #eee;
  }
  #sort select {
    flex: 1;
    border: none;
    background: transparent;
    font-size: 14px;
    cursor: pointer;
    -webkit-appearance: none;
    appearance: none;
  }
  #sort select:focus {
    outline: none;
    box-shadow: none;
    border-color: #ccc;
  }
  .view_confy {
    background-color: #fce8ef;
    border-radius: 10px;
    padding: 4px;
    width: 24px;
    height: 24px;
    color: #ff5f9e;
  }

  /* ===== カード ===== */
  .card {
    background-color: white;
    border-radius: 14px;
    padding: 12px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    text-align: center;
  }

  .card img {
    width: 100%;
    height: 140px; /* 画像サイズ統一 */
    object-fit: cover; /* はみ出し防止 */
    border-radius: 10px;
  }

  .card h2 {
    font-size: 15px;
    margin: 8px 0 4px;
  }

  .card p {
    font-size: 13px;
    margin: 3px 0;
  }

  /* ===== ボトムナビ ===== */
  .bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 60px;
    background-color: #ffffff;
    display: flex;
    justify-content: space-around;
    align-items: center;
    border-top: 1px solid #ddd;
    box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.1);
  }

  /* ===== タグ ===== */
  .tags {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    justify-content: center;
    margin-top: 6px;
  }

  .tag {
    font-size: 11px;
    padding: 4px 8px;
    border-radius: 999px;
    background-color: #ffe1ec;
    color: #ff5f9e;
  }

  /* ===== チェックボックス ===== */
  .filters {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 20px;
  }

  .filters label {
    font-size: 12px;
    padding: 6px 10px;
    border-radius: 20px;
    background-color: #fff;
    border: 1px solid #ddd;
    cursor: pointer;
  }

  .filters input {
    display: none;
  }

  .filters input:checked + span {
    color: white;
    background-color: #ff5f9e;
  }
  #modalOverlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    width: 100%;
    height: 100%;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    visibility: hidden;
  }
  #modalOverlay.is-open {
    opacity: 1;
    visibility: visible;
  }
  @media screen and (max-width: 430px) {
    #hero-section{
      padding-top: 0;
    }
      .circles li:nth-child(1){
      width: 50px;
      height: 50px;
    }


    .circles li:nth-child(2){
      width: 20px;
      height: 20px;
    }

    .circles li:nth-child(3){
      width: 20px;
      height: 20px;
    }

    .circles li:nth-child(4){
      width: 30px;
      height: 30px;
    }

    .circles li:nth-child(5){
      width: 20px;
      height: 20px;
    }

    .circles li:nth-child(6){
      width: 80px;
      height: 80px;
    }

    .circles li:nth-child(7){
      width: 80px;
      height: 80px;
    }

    .circles li:nth-child(8){
      width: 25px;
      height: 25px;
    }
    /* 無くす */
    .circles li:nth-child(9){
      width: 0;
      height: 0;
    }
    .circles li:nth-child(10){
      width: 80px;
      height: 80px;
    }
    #modalOverlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      width: 100%;
      height: 100%;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 1;
      visibility: hidden;
      transition: opacity 0.2s ease;
    }
    #modalOverlay.is-open {
      opacity: 1;
      visibility: visible;
    }
    #modalOverlay.is-open .modal {
      transform: translateY(0);
      transition-delay: 0.15s;
    }
  }
</style>
<!-- ここまでです！！ -->
{%endblock%}
